<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <!-- Primary Meta Tags -->
  <title>Golf Course Weather & Forecast | Fairway Weather ‚Äì Tee Time Conditions</title>
  <meta name="description" content="Golf course weather forecast app. Check wind, rain & playability before your round. Find the best tee time with real-time golf weather conditions for any course worldwide." />
  <meta name="keywords" content="golf course weather, golf weather forecast, golf weather app, tee time weather, golf playability, golf wind conditions, golf rain forecast, best time to play golf, fairway weather golf, golf forecast today" />
  <meta name="author" content="Fairway Weather - Golf Course Forecast" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://www.fairwayweather.com/" />
  
  <!-- Disambiguation: This is a golf app, not Fairway Kansas weather -->
  <meta name="geo.region" content="GLOBAL" />
  <meta name="subject" content="Golf Course Weather Forecasts and Tee Time Planning" />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.fairwayweather.com/" />
  <meta property="og:site_name" content="Fairway Weather - Golf Course Forecast" />
  <meta property="og:title" content="Golf Course Weather Forecast | Check Conditions Before You Tee Off" />
  <meta property="og:description" content="Free golf weather app. Check wind, rain & course playability before your round. Real-time golf course weather forecasts worldwide." />
  <meta property="og:image" content="https://www.fairwayweather.com/icons/icon-512.png" />
  <meta property="og:image:width" content="512" />
  <meta property="og:image:height" content="512" />
  <meta property="og:image:alt" content="Fairway Weather Golf Forecast App" />
  <meta property="og:locale" content="en_US" />
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@fairwayweather" />
  <meta name="twitter:title" content="Golf Course Weather Forecast | Fairway Weather" />
  <meta name="twitter:description" content="Check golf course weather before your round. Wind, rain, playability scores & best tee times for any golf course." />
  <meta name="twitter:image" content="https://www.fairwayweather.com/icons/icon-512.png" />
  <meta name="twitter:image:alt" content="Fairway Weather Golf Forecast App" />

  <!-- PWA -->
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#1F6F78" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Fairway Forecast" />

  <!-- Structured Data for Rich Snippets -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Fairway Weather - Golf Course Forecast",
    "alternateName": ["Golf Course Weather App", "Fairway Weather Golf", "Golf Weather Forecast"],
    "url": "https://www.fairwayweather.com",
    "description": "Golf course weather forecast app. Check wind, rain and playability conditions before your round. Find the best tee time with real-time golf weather for any course worldwide.",
    "applicationCategory": "SportsApplication",
    "applicationSubCategory": "Golf Weather Forecast",
    "operatingSystem": "Any",
    "browserRequirements": "Requires JavaScript",
    "softwareVersion": "1.0",
    "keywords": "golf weather, golf course forecast, tee time weather, golf playability, golf conditions",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD",
      "description": "Free golf course weather forecasts"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "ratingCount": "150",
      "bestRating": "5",
      "worstRating": "1"
    },
    "author": {
      "@type": "Organization",
      "name": "Fairway Weather",
      "url": "https://www.fairwayweather.com"
    },
    "about": {
      "@type": "Thing",
      "name": "Golf",
      "description": "Weather forecasts specifically designed for golfers"
    }
  }
  </script>
  
  <!-- Additional Schema: SportsOrganization context -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Fairway Weather - Golf Course Forecast",
    "alternateName": "Golf Course Weather",
    "url": "https://www.fairwayweather.com",
    "description": "Golf weather forecasts for courses worldwide",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://www.fairwayweather.com/?search={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>

  <!-- Security -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://static.cloudflareinsights.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
    img-src 'self' https: data:;
    connect-src 'self' https://fairway-forecast-api.mziyabo.workers.dev https://*.supabase.co https://api.openweathermap.org;
    frame-ancestors 'none';
    base-uri 'self';
    form-action 'self';
  " />

  <!-- Icons -->
  <link rel="icon" href="./icons/favicon.ico" />
  <link rel="apple-touch-icon" href="/icons/icon-192.png" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Fuse.js for fuzzy search -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0/dist/fuse.min.js"></script>

  <!-- Cloudflare Web Analytics -->
  <script
    defer
    src="https://static.cloudflareinsights.com/beacon.min.js"
    data-cf-beacon='{"token": "ff6b1058ad0a4e808cf1853bbb80d0f6"}'
  ></script>
  <!-- End Cloudflare Web Analytics -->

  <!-- Styles -->
  <link rel="stylesheet" href="./assets/styles.951de612.css" />
</head>

<body>
<main class="ff-wrap">
    <section class="ff-shell">
      <!-- ================= HEADER ================= -->
      <header class="ff-topbar" aria-label="App header">
        <div class="ff-topbar-left">
          <img src="./icons/icon-192.png" alt="Fairway Weather" class="ff-topbar-logo" />
          <div class="ff-topbar-text">
            <div class="ff-topbar-title">
              Fairway Weather <span class="ff-topbar-badge">Golf</span>
            </div>
            <div class="ff-topbar-tagline">Know before you tee.</div>
          </div>
        </div>
      </header>

      <!-- ================= ROUND SELECTION TOOL (PRIMARY) ================= -->
      <section class="ff-panel ff-round-tool" aria-label="Round Selection Tool">
        <div class="ff-round-tool-head">
          <div class="ff-round-tool-title">Round Selection</div>
          <div class="ff-round-tool-sub">Choose course ‚Üí pick a tee time window ‚Üí get a quick verdict.</div>
        </div>

        <!-- Step 1: Country / State -->
        <div class="ff-round-step">
          <div class="ff-round-step-label">Step 1 ¬∑ Country / Region</div>
          <select id="countrySelect" class="ff-select ff-select-country" aria-describedby="countryHelp">
            <!-- Options populated by JS -->
          </select>

          <div id="stateSelectRow" class="ff-state-row" style="display: none;">
            <div class="ff-round-step-label" style="margin-top:10px;">State</div>
            <select id="stateSelect" class="ff-select ff-select-state">
              <option value="">Select a state...</option>
              <!-- Options populated by JS -->
            </select>
          </div>

          <div id="countryHelp" class="ff-hint ff-osm-attribution">
            Course data ¬© <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap contributors</a>
          </div>
        </div>

        <!-- Step 2: Course search -->
        <div class="ff-round-step">
          <div class="ff-round-step-label">Step 2 ¬∑ Course</div>
          <div class="ff-search-row">
            <input
              id="searchInput"
              class="ff-input"
              type="search"
              placeholder='Type course name...'
              autocomplete="off"
              inputmode="search"
              aria-describedby="searchHelp"
            />
            <button id="btnGeo" class="ff-btn ff-btn-ghost" type="button" title="Use my location" aria-label="Use my location">
              ‚åñ
            </button>
          </div>

          <div id="searchHelp" class="ff-hint">
            Start typing to see course suggestions
          </div>

          <!-- Results inline -->
          <section id="searchResultsSlot" class="ff-search-results" aria-live="polite" aria-label="Search results"></section>
        </div>

        <!-- Step 3: Round options -->
        <div class="ff-round-step">
          <div class="ff-round-step-label">Step 3 ¬∑ Round</div>
          <div class="ff-round-presets" role="group" aria-label="Round presets">
            <button type="button" class="ff-chip" id="roundPreset18">18 holes (~4h)</button>
            <button type="button" class="ff-chip" id="roundPreset9">9 holes (~2h)</button>
            <button type="button" class="ff-chip" id="roundPresetSociety">Society tee sheet</button>
          </div>
          <div class="ff-round-micro">Tee times are generated every 8 minutes.</div>

          <div id="societyControls" class="ff-society" style="display:none;">
            <label class="ff-label" for="societyGroups">Groups</label>
            <input id="societyGroups" class="ff-input" type="number" min="2" max="60" step="1" value="12" />
            <div class="ff-hint">Generates an 8‚Äëminute tee sheet starting from your selected tee time.</div>
          </div>
        </div>

        <!-- Step 4: Tee time strip + verdict -->
        <div class="ff-round-step">
          <div class="ff-round-step-label">Step 4 ¬∑ Tee time & verdict</div>

          <section id="teeTimeStripSection" class="ff-tee-time-strip" style="display:none;" aria-label="Tee time decision">
            <div class="ff-tee-strip-card">
              <div class="ff-tee-eyebrow">Your tee time</div>
              <div class="ff-tee-strip-header">
                <div class="ff-tee-strip-status" id="teeTimeStatus">
                  <span class="ff-tee-status-icon" id="teeTimeIcon" aria-hidden="true">‚è≥</span>
                  <span class="ff-tee-status-label" id="teeTimeLabel">Select tee time</span>
                </div>
                <div class="ff-tee-selected-time" id="teeSelectedTime" aria-live="polite">
                  <span id="teeSelectedLabel"></span>
                </div>
              </div>

              <div class="ff-tee-date-row">
                <div class="ff-tee-date-chips" id="teeDateChips" role="group" aria-label="Select date"></div>
              </div>

              <div class="ff-tee-time-row">
                <label class="ff-tee-time-label">
                  <span class="ff-tee-time-icon" aria-hidden="true">üïê</span>
                  Time
                </label>
                <div class="ff-tee-time-selector" role="group" aria-label="Select tee time">
                  <select id="teeTimeSelect" class="ff-tee-select" aria-describedby="teeTimeDesc"></select>
                </div>
              </div>

              <div class="ff-tee-applied-msg" id="teeAppliedMsg" style="display:none;">
                Applied from Round Planner
              </div>

              <div class="ff-tee-strip-metrics" id="teeTimeMetrics" aria-live="polite">
                <div class="ff-tee-metric">
                  <span class="ff-tee-metric-icon" aria-hidden="true">üåßÔ∏è</span>
                  <span class="ff-tee-metric-label">Rain</span>
                  <strong class="ff-tee-metric-value" id="teeMetricRain">‚Äî</strong>
                </div>
                <div class="ff-tee-metric">
                  <span class="ff-tee-metric-icon" aria-hidden="true">üí®</span>
                  <span class="ff-tee-metric-label">Wind</span>
                  <strong class="ff-tee-metric-value" id="teeMetricWind">‚Äî</strong>
                </div>
                <div class="ff-tee-metric">
                  <span class="ff-tee-metric-icon" aria-hidden="true">üå°Ô∏è</span>
                  <span class="ff-tee-metric-label">Temp</span>
                  <strong class="ff-tee-metric-value" id="teeMetricTemp">‚Äî</strong>
                </div>
                <div class="ff-tee-metric">
                  <span class="ff-tee-metric-icon" aria-hidden="true">üí•</span>
                  <span class="ff-tee-metric-label">Gusts</span>
                  <strong class="ff-tee-metric-value" id="teeMetricGust">‚Äî</strong>
                </div>
              </div>

              <p class="ff-tee-strip-summary" id="teeTimeSummary" aria-live="polite">
                Select a tee time to see conditions for your round.
              </p>
              <span id="teeTimeDesc" class="ff-sr-only">Shows weather conditions for your round starting at the selected time.</span>
            </div>
          </section>

          <div id="teeSheetSlot" class="ff-tee-sheet" style="display:none;"></div>
        </div>

        <div class="ff-units-row" style="margin-top: 6px;">
          <label class="ff-label" for="unitsSelect">Units</label>
          <select id="unitsSelect" class="ff-select">
            <option value="metric">¬∞C / m¬∑s</option>
            <option value="imperial">¬∞F / mph</option>
          </select>
        </div>
      </section>

      <!-- ================= LOCATION ================= -->
      <section aria-label="Location">
        <div class="ff-section-label">Location</div>
        <div id="locationSlot"></div>

        <div class="ff-hint">
          Tap ‚òÖ to add or remove favourites
        </div>
      </section>

      <!-- ================= TABS ================= -->
      <nav class="ff-tabs" aria-label="Forecast tabs">
        <button id="tabCurrent" class="ff-tab active" type="button">Current</button>
        <button id="tabHourly" class="ff-tab" type="button">Hourly</button>
        <button id="tabDaily" class="ff-tab" type="button">Daily</button>
      </nav>

      <!-- Tee-time strip moved into Round Selection Tool above -->
      
      <!-- ================= ADVANCED OPTIONS (Feature-flagged) ================= -->
      <section id="advancedSection" class="ff-advanced ff-feature-advanced-wind" style="display:none;">
        <button type="button" id="advancedToggle" class="ff-advanced-toggle">
          <span>Advanced</span>
          <span id="advancedArrow" class="ff-advanced-arrow">‚ñº</span>
        </button>
        <div id="advancedOptions" class="ff-advanced-options" style="display:none;">
          <div class="ff-course-direction">
            <label class="ff-label" for="courseDirectionSelect">Course direction (for wind impact)</label>
            <select id="courseDirectionSelect" class="ff-select">
              <option value="">Not set</option>
              <option value="N">N (North)</option>
              <option value="NE">NE (Northeast)</option>
              <option value="E">E (East)</option>
              <option value="SE">SE (Southeast)</option>
              <option value="S">S (South)</option>
              <option value="SW">SW (Southwest)</option>
              <option value="W">W (West)</option>
              <option value="NW">NW (Northwest)</option>
            </select>
          </div>
        </div>
      </section>

      <!-- ================= PREMIUM TEASER ================= -->
      <section id="premiumTeaserSection" class="ff-premium-teaser" style="display:none;">
        <div class="ff-premium-card">
          <div class="ff-premium-header">
            <span class="ff-premium-pill">Premium</span>
            <span class="ff-premium-title">Coming soon</span>
          </div>
          <ul class="ff-premium-features">
            <li>
              <span class="ff-premium-feature-icon">üìÖ</span>
              <span class="ff-premium-feature-text">Round Planner ‚Äî best daylight tee times</span>
            </li>
            <li>
              <span class="ff-premium-feature-icon">üí®</span>
              <span class="ff-premium-feature-text">Advanced Wind Impact ‚Äî gale detection</span>
            </li>
          </ul>
          <button type="button" id="getPremiumBtn" class="ff-btn ff-btn-premium">
            Get Premium
          </button>
        </div>
      </section>

      <!-- ================= ROUND PLANNER (Feature-flagged) ================= -->
      <section aria-label="Round planner" id="roundPlannerSection">
        <div class="ff-section-label">Round Planner</div>

        <div id="verdict-card">
        <section id="verdictCard" class="ff-panel ff-verdict ff-verdict--neutral" aria-live="polite">
          <div class="ff-planner-subtitle">Best daylight tee time. Tap to apply.</div>
          
          <div class="ff-verdict-main">
            <div class="ff-verdict-badge" aria-hidden="true">
              <span id="verdictIcon">‚è≥</span>
            </div>

            <div class="ff-verdict-text">
              <div id="verdictLabel" class="ff-verdict-label">Loading‚Ä¶ <span class="ff-info-icon" title="Click for more info">‚ÑπÔ∏è</span></div>
              <div id="verdictReason" class="ff-verdict-reason">‚Äî</div>

              <div class="ff-verdict-quick-stats" id="verdictQuickStats"></div>

              <div class="ff-verdict-time" id="verdictTime">
                <span id="localTime">‚Äî</span>
                <span class="ff-time-separator">¬∑</span>
                <span id="gmtTime">‚Äî</span>
              </div>
              <div class="ff-time-hint">Course local time</div>

              <div class="ff-verdict-meta">
                <span>Recommended tee time</span>
                <strong id="verdictBestTime">‚Äî</strong>
              </div>
              
              <button type="button" id="applyPlannerBtn" class="ff-btn ff-btn-apply" style="display:none;">
                Apply to my tee time
              </button>
            </div>
          </div>
        </section>
        </div>

        <!-- ================= PLAYABILITY INDEX ================= -->
        <section class="ff-panel ff-panel--challenge" style="margin-top:var(--gap);">
          <div class="ff-challenge">
            <div class="ff-challenge-header">
              <div class="ff-challenge-title">
                Playability Index
                <span class="ff-info-icon" id="playabilityInfoBtn" title="How is this calculated?">‚ÑπÔ∏è</span>
              </div>
              <div id="challengeRating" class="ff-challenge-badge">‚Äî</div>
            </div>
            <div id="challengeReason" class="ff-challenge-reason"></div>
          </div>
        </section>
      </section>

      <!-- ================= RESULTS (FORECAST ONLY) ================= -->
      <section id="results" class="ff-results" aria-live="polite">
        <div>
          <div class="ff-section-label">Forecast</div>
          <div id="forecastSlot"></div>
        </div>
      </section>

      <!-- ================= ROUND-BASED PLAYABILITY ================= -->
      <section id="roundPlayabilitySection" style="display:none;">
        <div class="ff-section-label">Round Windows</div>
        <div id="roundPlayabilityCard" class="ff-card"></div>
      </section>

      <!-- ================= COURSE DIFFICULTY ================= -->
      <section id="courseDifficultySection" class="ff-panel ff-panel--difficulty" style="display:none;">
        <div class="ff-difficulty">
          <div class="ff-difficulty-header">
            <div class="ff-difficulty-title">Course Difficulty</div>
            <div id="difficultyBadge" class="ff-difficulty-badge">‚Äî</div>
          </div>
          <div class="ff-difficulty-stats">
            <div class="ff-difficulty-stat">
              <span class="ff-difficulty-label">Slope</span>
              <strong id="slopeValue">‚Äî</strong>
            </div>
            <div class="ff-difficulty-stat">
              <span class="ff-difficulty-label">Rating</span>
              <strong id="ratingValue">‚Äî</strong>
            </div>
            <div class="ff-difficulty-stat">
              <span class="ff-difficulty-label">Par</span>
              <strong id="parValue">‚Äî</strong>
            </div>
          </div>
        </div>
      </section>

      <!-- ================= LAST UPDATED ================= -->
      <div id="lastUpdated" class="ff-last-updated"></div>
    </section>

    <!-- ================= FOOTER ================= -->
    <footer class="ff-foot">
      <p><strong>Fairway Weather</strong> ‚Äì Golf Course Weather Forecasts</p>
      <p class="ff-foot-tagline">Check golf weather conditions before your round. Best tee times & playability for golfers worldwide.</p>
      <p class="ff-foot-credits">Weather data ¬© <a href="https://openweathermap.org" target="_blank" rel="noopener">OpenWeather</a></p>
      <p class="ff-foot-credits ff-osm-attribution">Course data ¬© <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap contributors</a></p>
      <div class="ff-support">
        <a
          class="ff-support-btn"
          href="https://buymeacoffee.com/godskid"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Support Fairway Forecast on Buy Me a Coffee"
        >
          Support ‚òï
        </a>
        <div class="ff-support-note">If this forecast saved you a wasted trip, consider buying a coffee.</div>
</div>
      <p class="ff-foot-copy">¬© 2024 Fairway Weather ¬∑ Not affiliated with Fairway, Kansas</p>
    </footer>

  </main>

  <!-- PWA INSTALL CTA (shows only when installable / iOS A2HS) -->
  <div id="pwaInstallBanner" class="ff-pwa-banner" hidden>
    <div class="ff-pwa-banner__text">
      <div class="ff-pwa-banner__title">Install Fairway Weather</div>
      <div id="pwaInstallBannerBody" class="ff-pwa-banner__body">Get faster access and offline support.</div>
    </div>
    <div class="ff-pwa-banner__actions">
      <button id="pwaInstallAction" class="ff-btn ff-btn-apply" type="button">Install</button>
      <button id="pwaInstallDismiss" class="ff-btn ff-btn-ghost" type="button">Not now</button>
    </div>
  </div>

  <style>
    .ff-pwa-banner[hidden] { display: none !important; }
    .ff-pwa-banner {
      position: fixed;
      left: 12px;
      right: 12px;
      bottom: calc(12px + env(safe-area-inset-bottom));
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 12px;
      border-radius: 14px;
      background: rgba(11, 31, 42, 0.92);
      color: rgba(255, 255, 255, 0.95);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.22);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      max-width: 720px;
      margin: 0 auto;
    }
    .ff-pwa-banner__title { font-weight: 800; letter-spacing: 0.2px; font-size: 13px; line-height: 1.15; }
    .ff-pwa-banner__body { font-size: 12px; opacity: 0.92; line-height: 1.25; margin-top: 2px; }
    .ff-pwa-banner__actions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; justify-content: flex-end; }
    .ff-pwa-banner__actions .ff-btn { white-space: nowrap; }
    body.ff-pwa-banner-on { padding-bottom: 92px; }
    @media (max-width: 420px) {
      .ff-pwa-banner { align-items: flex-start; }
      .ff-pwa-banner__actions { width: 100%; justify-content: flex-start; }
    }
  </style>

  <!-- PREMIUM EXPLAINER MODAL -->
  <div id="infoModal" class="ff-modal" hidden>
    <div class="ff-modal-backdrop"></div>
    <div class="ff-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="infoModalTitle">
      <button type="button" id="infoModalClose" class="ff-modal-close" aria-label="Close explanation">√ó</button>
      <h2 id="infoModalTitle" class="ff-modal-title"></h2>
      <p id="infoModalBody" class="ff-modal-body"></p>
    </div>
  </div>

  <script src="./assets/config.e2947c83.js"></script>
  <script src="./assets/playability.84cd2160.js"></script>
  <script src="./assets/app.3db08541.js"></script>
  <script>
    (function () {
      if (!("serviceWorker" in navigator)) return;
      window.addEventListener("load", function () {
        navigator.serviceWorker.register("/sw.js").then(
          function (registration) {
            console.log("[PWA] Service worker registered:", registration.scope);
          },
          function (err) {
            console.warn("[PWA] Service worker registration failed:", err);
          }
        );
      });
    })();
  </script>
  <script>
    (function () {
      var DISMISS_KEY = "fw_pwa_install_dismissed_at";
      var DISMISS_MS = 7 * 24 * 60 * 60 * 1000; // 7 days
      var deferredPrompt = null;

      function isStandalone() {
        return (window.matchMedia && window.matchMedia("(display-mode: standalone)").matches) || window.navigator.standalone === true;
      }

      function isIos() {
        var ua = window.navigator.userAgent || "";
        return /iPad|iPhone|iPod/.test(ua) || (ua.includes("Mac") && "ontouchend" in document);
      }

      function isSafari() {
        var ua = window.navigator.userAgent || "";
        return /Safari/.test(ua) && !/Chrome|CriOS|Edg|OPR|FxiOS/.test(ua);
      }

      function shouldShow() {
        if (isStandalone()) return false;
        try {
          var ts = Number(localStorage.getItem(DISMISS_KEY) || "0");
          if (ts && Date.now() - ts < DISMISS_MS) return false;
        } catch (_) {}
        return true;
      }

      function setBannerVisible(visible) {
        var banner = document.getElementById("pwaInstallBanner");
        if (!banner) return;
        if (visible) {
          banner.hidden = false;
          document.body.classList.add("ff-pwa-banner-on");
        } else {
          banner.hidden = true;
          document.body.classList.remove("ff-pwa-banner-on");
        }
      }

      function dismissBanner() {
        try { localStorage.setItem(DISMISS_KEY, String(Date.now())); } catch (_) {}
        setBannerVisible(false);
      }

      function wireButtons(actionMode) {
        var action = document.getElementById("pwaInstallAction");
        var dismiss = document.getElementById("pwaInstallDismiss");
        if (dismiss) dismiss.addEventListener("click", dismissBanner);
        if (!action) return;

        action.addEventListener("click", function () {
          if (actionMode === "prompt" && deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then(function () {
              deferredPrompt = null;
              dismissBanner();
            });
            return;
          }
          // iOS: no native prompt; show a short instruction.
          window.alert("To install: tap the Share button in Safari, then 'Add to Home Screen'.");
        });
      }

      // Android/Desktop: capture install prompt and show CTA
      window.addEventListener("beforeinstallprompt", function (e) {
        // Don‚Äôt show immediately; keep it available for our button.
        e.preventDefault();
        deferredPrompt = e;
        if (!shouldShow()) return;
        var body = document.getElementById("pwaInstallBannerBody");
        if (body) body.textContent = "Install for faster access (and offline support).";
        var action = document.getElementById("pwaInstallAction");
        if (action) action.textContent = "Install";
        wireButtons("prompt");
        setBannerVisible(true);
      });

      // iOS Safari: show Add-to-Home-Screen hint
      window.addEventListener("load", function () {
        if (!shouldShow()) return;
        if (isIos() && isSafari() && !isStandalone()) {
          var body = document.getElementById("pwaInstallBannerBody");
          if (body) body.textContent = "On iPhone/iPad: Share ‚Üí Add to Home Screen.";
          var action = document.getElementById("pwaInstallAction");
          if (action) action.textContent = "How to install";
          wireButtons("ios");
          setBannerVisible(true);
        }
      });

      window.addEventListener("appinstalled", function () {
        deferredPrompt = null;
        setBannerVisible(false);
      });
    })();
  </script>
</body>

</html>
